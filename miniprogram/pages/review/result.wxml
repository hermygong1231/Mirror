<!-- pages/review/result.wxml -->
<view class="page-container">
  <view class="loading-state" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <view wx:elif="{{analyzing}}">
    <view class="analyzing-state">
      <!-- åŠ¨ç”»è„‘å›¾å›¾æ ‡ -->
      <view class="analyzing-brain">
        <view class="brain-circle brain-circle--1"></view>
        <view class="brain-circle brain-circle--2"></view>
        <view class="brain-circle brain-circle--3"></view>
        <view class="analyzing-icon">ğŸ§ </view>
      </view>

      <text class="analyzing-text">æ£±é•œæ­£åœ¨æŠ˜å°„ä½ çš„å†³ç­–...</text>

      <!-- é‡‘å¥è½®æ’­ -->
      <view class="quote-container {{quoteVisible ? 'quote-visible' : ''}}" wx:if="{{currentQuote}}">
        <text class="quote-text">"{{currentQuote.text}}"</text>
        <text class="quote-author">â€” {{currentQuote.author}}</text>
      </view>

      <!-- è¿›åº¦ç‚¹ -->
      <view class="analyzing-dots">
        <view class="dot dot--1"></view>
        <view class="dot dot--2"></view>
        <view class="dot dot--3"></view>
      </view>
    </view>
  </view>

  <view wx:elif="{{analysis}}">
    <!-- å¤´éƒ¨ -->
    <view class="result-header">
      <text class="result-title">{{isPositive ? 'ğŸŒŸ æ£±é•œ Â· æˆåŠŸæŠ˜å°„' : 'ğŸ” æ£±é•œ Â· å†³ç­–æŠ˜å°„'}}</text>
    </view>

    <!-- æ ¸å¿ƒæ´å¯Ÿ -->
    <view class="result-section" wx:if="{{analysis.coreIssue}}">
      <view class="section-card core-card {{isPositive ? 'core-positive' : ''}}">
        <text class="card-icon">{{isPositive ? 'ğŸ†' : 'ğŸ¯'}}</text>
        <text class="core-text">{{analysis.coreIssue}}</text>
      </view>
    </view>

    <!-- åˆ†ææ€»ç»“ -->
    <view class="result-section">
      <view class="section-card">
        <view class="card-header">
          <text class="card-icon">ğŸ“Š</text>
          <text class="card-title">{{isPositive ? 'æˆåŠŸåˆ†æ' : 'åˆ†ææ€»ç»“'}}</text>
        </view>
        <text class="card-content">{{analysis.summary}}</text>
      </view>
    </view>

    <!-- è®¤çŸ¥æ ‡ç­¾ -->
    <view class="result-section" wx:if="{{analysis.biasLabels.length > 0}}">
      <view class="section-card">
        <view class="card-header">
          <text class="card-icon">ğŸ§ </text>
          <text class="card-title">{{isPositive ? 'æ€ç»´ä¼˜åŠ¿' : 'è¯†åˆ«çš„è®¤çŸ¥åå·®'}}</text>
        </view>
        <view class="bias-list">
          <view class="bias-tag {{isPositive ? 'bias-positive' : ''}}" wx:for="{{analysis.biasLabels}}" wx:key="*this">
            {{item}}
          </view>
        </view>
      </view>
    </view>

    <!-- è¡Œä¸ºæ¨¡å¼å¯¹æ¯” -->
    <view class="result-section" wx:if="{{analysis.currentPattern || analysis.suggestedPrinciple}}">
      <view class="section-card principle-card">
        <view class="card-header">
          <text class="card-icon">ğŸ’¡</text>
          <text class="card-title">{{isPositive ? 'æˆåŠŸç»éªŒ' : 'è¡Œä¸ºæ¨¡å¼æ´å¯Ÿ'}}</text>
        </view>
        <view class="pattern-compare">
          <view class="pattern-item {{isPositive ? 'pattern-good' : 'pattern-current'}}" wx:if="{{analysis.currentPattern}}">
            <text class="pattern-label">{{isPositive ? 'ä½ çš„ä¼˜åŠ¿' : 'ä½ è¿™æ¬¡çš„æ¨¡å¼'}}</text>
            <text class="pattern-text">{{analysis.currentPattern}}</text>
          </view>
          <view class="pattern-arrow" wx:if="{{analysis.currentPattern && analysis.suggestedPrinciple}}">â†’</view>
          <view class="pattern-item pattern-suggest" wx:if="{{analysis.suggestedPrinciple}}">
            <text class="pattern-label">{{isPositive ? 'æç‚¼ä¸ºåŸåˆ™' : 'å»ºè®®è°ƒæ•´ä¸º'}}</text>
            <text class="pattern-text">{{analysis.suggestedPrinciple}}</text>
          </view>
        </view>
      </view>
    </view>
    <!-- å…¼å®¹æ—§æ•°æ® -->
    <view class="result-section" wx:elif="{{analysis.principle}}">
      <view class="section-card principle-card">
        <view class="card-header">
          <text class="card-icon">ğŸ’¡</text>
          <text class="card-title">æ™ºèƒ½å»ºè®®çš„å†³ç­–åŸåˆ™</text>
        </view>
        <text class="principle-text">{{analysis.principle}}</text>
      </view>
    </view>

    <!-- å»ºè®® -->
    <view class="result-section" wx:if="{{analysis.suggestion}}">
      <view class="section-card">
        <view class="card-header">
          <text class="card-icon">ğŸ”®</text>
          <text class="card-title">{{isPositive ? 'å¦‚ä½•å»¶ç»­ä¼˜åŠ¿' : 'ä¸‹æ¬¡å†³ç­–å»ºè®®'}}</text>
        </view>
        <text class="card-content">{{analysis.suggestion}}</text>
      </view>
    </view>

    <!-- åé¦ˆ -->
    <view class="feedback-section" wx:if="{{!feedbackSent}}">
      <text class="feedback-title">è¿™æ¬¡åˆ†æï¼Œæœ‰æ²¡æœ‰æ‰“ç ´ä½ çš„è®¤çŸ¥ï¼Ÿ</text>
      <view class="feedback-btns">
        <button class="feedback-btn agree" bindtap="sendFeedback" data-agreed="true">
          ğŸ”¨ ç ´å£äº†
        </button>
        <button class="feedback-btn disagree" bindtap="sendFeedback" data-agreed="false">
          ğŸ§± æ²¡ç ´
        </button>
      </view>
    </view>
    <view class="feedback-section feedback-done" wx:elif="{{feedbackAgreed}}">
      <text>ğŸ”¨ å·²ç ´å£ Â· è®¤çŸ¥åˆè¿›äº†ä¸€æ­¥</text>
    </view>
    <view class="feedback-section feedback-done" wx:else>
      <text>ğŸ§± å·²è®°å½• Â· ä¸‹æ¬¡ä¼šæ›´å‡†</text>
    </view>

    <!-- åº•éƒ¨æ“ä½œ -->
    <view class="action-section">
      <button class="btn-home" bindtap="goHome">è¿”å›é¦–é¡µ</button>
    </view>
  </view>
</view>
